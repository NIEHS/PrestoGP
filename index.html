<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Simultaneous variable seletion and estimation of LUR models with spatiotemporally correlated errors that is scalable for big data.">
<title>Penalized Regression for Spatio-Temporal Outcomes via Gaussian Processes  • PrestoGP</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Penalized Regression for Spatio-Temporal Outcomes via Gaussian Processes ">
<meta property="og:description" content="Simultaneous variable seletion and estimation of LUR models with spatiotemporally correlated errors that is scalable for big data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">PrestoGP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9026</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="prestogp-penalized-regression-on-spatiotemporal-outcomes-using-gaussian-process">PrestoGP: Penalized Regression on Spatiotemporal Outcomes using Gaussian Process<a class="anchor" aria-label="anchor" href="#prestogp-penalized-regression-on-spatiotemporal-outcomes-using-gaussian-process"></a>
</h2>
<p><a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/check-standard.yaml" class="external-link"><img src="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/check-standard.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/test-coverage.yaml/badge.svg" alt="test-coverage"></a> <a href="https://codecov.io/gh/Spatiotemporal-Exposures-and-Toxicology/PrestoGP" class="external-link"><img src="https://codecov.io/gh/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/graph/badge.svg?token=eLxuNnsNYB" alt="codecov"></a> <a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/lint.yaml" class="external-link"><img src="https://github.com/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/actions/workflows/lint.yaml/badge.svg" alt="lint"></a></p>
<p><img src="https://codecov.io/gh/Spatiotemporal-Exposures-and-Toxicology/PrestoGP/graphs/icicle.svg?token=eLxuNnsNYB" alt="Code Coverage Visulation"> # LURK-Vecchia</p>
<p>Simultaneous variable seletion and estimation of LUR models with spatiotemporally correlated errors that is scalable for big data</p>
</div>
<div class="section level1">
<div class="page-header"><h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1></div>
<p>Messier, K.P. &amp; Katzfuss, M. (2020). Scalable penalized spatiotemporal land-use regression for ground-level nitrogen dioxide. <a href="https://arxiv.org/abs/2005.09210" class="external-link uri">https://arxiv.org/abs/2005.09210</a></p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>Based on the package GPvecchia (<a href="https://cran.r-project.org/web/packages/GPvecchia/index.html" class="external-link uri">https://cran.r-project.org/web/packages/GPvecchia/index.html</a>) and ncvreg (<a href="https://cran.r-project.org/web/packages/ncvreg/index.html" class="external-link uri">https://cran.r-project.org/web/packages/ncvreg/index.html</a>). Install the following R packages: GPvecchia,ncvreg, fields, Matrix</p>
<p>Download LURK_Functions.R to your local machine and use R to source:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"/Location/of/your/functions/LURK_Functions.R"</span><span class="op">)</span> </span></code></pre>
</div>
<div class="section level1">
<h1 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h1>
<div class="section level2">
<h2 id="no2">NO<sub>2</sub><a class="anchor" aria-label="anchor" href="#no2"></a>
</h2>
<p>The NO<sub>2</sub> analysis data are stored in a single csv file in the <a href="https://github.com/NIEHS/LURK-Vecchia/tree/master/data" class="external-link">data</a> subfolder.</p>
<pre><code><span><span class="va">US_ST_NO2_Data.csv</span></span></code></pre>
<p>Columns 1 - 6 are latitude, longitude, date, NO2 concentration, and time in fractional years, respectively. Columns 7 - 145 make up the design matrix of covariates. The covariate names are followed by the distance hyperparameter (i.e. buffer, decay range). To see all of the field names, call:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">US_ST_NO2_Data</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h2>
<p>The simulation analysis data are stored in Excel files in the <a href="https://github.com/NIEHS/LURK-Vecchia/tree/master/data" class="external-link">data</a> subfolder. There is an Excel file for each spatiotemporal parameter that is varied: nugget-to-sill ratio, total variance (sill), spatial range, and temporal range. For each spatiotemporal parameter there is a training set and test set, stored in separate files. The training and test sets are based on the same simulation.</p>
<pre><code><span><span class="va">Vecchia_ST_Simulation_NUG2SILL5_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_NUG2SILL5_test_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_VARIANCE5_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_VARIANCE5_test_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_SPATIAL_RANGES5_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_SPATIAL_RANGES5_test_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_TEMPORAL_RANGES5_20191107.xlsx</span></span>
<span><span class="va">Vecchia_ST_Simulation_TEMPORAL_RANGES5_test_20191107.xlsx</span></span></code></pre>
<p>Each Excel file contains a sheet for each simulation scenario - that is there are 20 sheets for 20 variations of the spatiotemporal parameter. Each sheet is simply labeled “1”, “2”,…, etc. for the simulation scenario. The first sheet also contains data for the true observations without measurement error and the covariates. Hence, in each simulation you see differences for the first sheet.</p>
<p>Here we go through an <strong>example</strong> of reading in data and assigning variables to help demonstrate the data format:</p>
<pre><code><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">read_excel</span><span class="op">(</span><span class="st">"Vecchia_ST_Simulation_NUG2SILL5_20191107.xlsx"</span>, </span>
<span>                                  sheet <span class="op">=</span> <span class="st">"1"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>The true data, without measurement error is read in:</p>
<pre><code><span><span class="co"># y true data</span></span>
<span><span class="va">Y.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>Columns 2 through 21 on the first sheet are the 20 simulation scenarios of y-observed (i.e. with measurement error). The covariates are read in.</p>
<pre><code><span><span class="co"># covariates</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data1</span><span class="op">[</span>,<span class="fl">22</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>There is a separate sheet for the spatial coordiantes:</p>
<pre><code><span><span class="co"># longitude and latitude</span></span>
<span><span class="va">xyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">read_excel</span><span class="op">(</span><span class="st">"Vecchia_ST_Simulation_NUG2SILL5_20191107.xlsx"</span>, </span>
<span>                            sheet <span class="op">=</span> <span class="st">"xy"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>The same information is also read in for the test set, which are 1000 other space-time observations from the same respective simulation.</p>
<pre><code><span><span class="va">xy_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">read_excel</span><span class="op">(</span><span class="st">"Vecchia_ST_Simulation_NUG2SILL5_test_20191107.xlsx"</span>, </span>
<span>                                sheet <span class="op">=</span> <span class="st">"1"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_xyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">read_excel</span><span class="op">(</span><span class="st">"Vecchia_ST_Simulation_NUG2SILL5_test_20191107.xlsx"</span>, </span>
<span>                                 sheet <span class="op">=</span> <span class="st">"xy"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">xy_test</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">xy_test</span><span class="op">[</span>,<span class="fl">22</span><span class="op">:</span><span class="fl">144</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>The main simulations go through nested loops: The outer loop (i) goes through each parameter variation (e.g. differing nugget-to-sill ratio). The inner loop (j) goes through random simulations of the same parameter values. Example below:</p>
<pre><code>for (i in 1:20){
  
  ### Read in the simulated data
  Ydata &lt;- read_excel("Vecchia_ST_Simulation_TEMPORAL_RANGES5_20191107.xlsx", 
                      sheet = as.character(i), col_names = FALSE)
  
  test_data &lt;- read_excel("Vecchia_ST_Simulation_TEMPORAL_RANGES5_test_20191107.xlsx", 
                          sheet = as.character(i), col_names = FALSE)</code></pre>
<p>The following if-else statement deals with the true data in column 1 of sheet 1.</p>
<pre><code><span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y.all</span> <span class="op">&lt;-</span> <span class="va">Ydata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span></span>
<span>    <span class="va">test_y</span> <span class="op">&lt;-</span> <span class="va">test_data</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">Y.all</span> <span class="op">&lt;-</span> <span class="va">Ydata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span></span>
<span>    <span class="va">test_y</span> <span class="op">&lt;-</span> <span class="va">test_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span></code></pre>
<p>Then the inner loop (j) goes through random realizations</p>
<pre><code>  for (j in 1:P){
    

    ########## Observed data for simulation j ############
    Y.obs &lt;- data.matrix(Y.all[,j])
    n=length(Y.obs)
    test_y_j &lt;- data.matrix(test_y[,j])</code></pre>
</div>
</div>
<div class="section level1">
<h1 id="running-the-simulation-analysis">Running the Simulation Analysis<a class="anchor" aria-label="anchor" href="#running-the-simulation-analysis"></a>
</h1>
<div class="section level2">
<h2 id="a-runnable-simulation-example">A runnable simulation example<a class="anchor" aria-label="anchor" href="#a-runnable-simulation-example"></a>
</h2>
<p>The beginning of the simulation contains one iteration of the paper’s full simulations. This is included so that a user can run a simulation and produce the results in a timely manner. Due to the number of simulations, the full paper simulations will take a long time. Note that the main simulations were sub-divided and ran on high-performance computing clusters.</p>
<p>The runnable simulation is the first section of Analysis_Simulation.R. The header of the section starts with:</p>
<pre><code><span><span class="co">####################################################################################################</span></span>
<span><span class="co">### SECTION 1</span></span>
<span><span class="co">### A short simulation scenario that can be run in a few minutes</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="replicating-the-paper-simulations">Replicating the paper simulations<a class="anchor" aria-label="anchor" href="#replicating-the-paper-simulations"></a>
</h2>
<p>The paper simulations have a section for each scenario. - Section 2: Variations of the temporal range - Section 3: Variations of the spatial range - Section 4: Variations of the nugget-to-sill ratio - Section 5: Variations of the total variance - Section 6: Convergence of estimated LUR coefficients (betas) with increasing m in the Vecchia approximation.</p>
</div>
</div>
<div class="section level1">
<h1 id="running-the-no2-analysis">Running the NO<sub>2</sub> Analysis<a class="anchor" aria-label="anchor" href="#running-the-no2-analysis"></a>
</h1>
<p>With the LURK_Functions sourced and the data accessible, run Analysis_NO2.R to replicate the 10-fold cross-validation NO<sub>2</sub> from the paper.</p>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PrestoGP</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Eric Bair <br><small class="roles"> Author, maintainer </small>  </li>
<li>Brian Kidd <br><small class="roles"> Author </small>  </li>
<li>Eric Wimberley <br><small class="roles"> Author </small>  </li>
<li>Deepak Mav <br><small class="roles"> Author </small>  </li>
<li>Kyle Messier <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Eric Bair, Brian Kidd, Eric Wimberley, Deepak Mav, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
